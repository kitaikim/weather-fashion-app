<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ëŠ˜ ë­ì…ì§€?</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", "Helvetica Neue", Arial, sans-serif;
            min-height: 100vh;
            padding: 20px;
            transition: background 1s ease;
            position: relative;
            overflow-x: hidden;
        }

        /* ë™ì  ë°°ê²½ ê·¸ë¼ë°ì´ì…˜ */
        body.weather-clear-day {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }

        body.weather-clear-night {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
        }

        body.weather-clouds-day {
            background: linear-gradient(135deg, #bdc3c7 0%, #2c3e50 100%);
        }

        body.weather-clouds-night {
            background: linear-gradient(135deg, #232526 0%, #414345 100%);
        }

        body.weather-rain {
            background: linear-gradient(135deg, #373b44 0%, #4286f4 50%, #373b44 100%);
        }

        body.weather-snow {
            background: linear-gradient(135deg, #e6dada 0%, #274046 100%);
        }

        body.weather-default {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease;
        }

        .header h1 {
            font-size: 3.5em;
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: -0.02em;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 1.4em;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 400;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .admin-link {
            text-align: center;
            margin-top: 15px;
        }

        .admin-link a {
            color: white;
            text-decoration: none;
            padding: 10px 24px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            font-size: 1em;
            transition: all 0.3s;
            display: inline-block;
        }

        .admin-link a:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        /* ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ ì¹´ë“œ */
        .card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            animation: fadeIn 0.6s ease;
        }

        .location-section {
            text-align: center;
            margin-bottom: 20px;
        }

        .location-input {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }

        /* ì„ í˜¸ë„ ì„¤ì • ì„¹ì…˜ */
        .preference-section {
            text-align: center;
            margin-top: 25px;
        }

        .preference-label {
            color: white;
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .preference-toggle {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .preference-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.7);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
        }

        .preference-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateY(-2px);
        }

        .preference-btn.active {
            background: rgba(255, 255, 255, 0.35);
            color: white;
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        input[type="text"], select {
            padding: 14px 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            font-size: 1em;
            width: 250px;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            cursor: pointer;
            color: white;
            font-weight: 500;
        }

        input[type="text"]::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        select option {
            background: #667eea;
            color: white;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        button {
            padding: 14px 28px;
            background: rgba(255, 255, 255, 0.25);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        button:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        button:active {
            transform: translateY(0);
        }

        .weather-info {
            text-align: center;
            padding: 25px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .weather-info h2 {
            color: white;
            margin-bottom: 20px;
            font-size: 2em;
            font-weight: 700;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        /* ì‹œê°„ëŒ€ë³„ ë‚ ì”¨ ê·¸ë¦¬ë“œ */
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .time-slot {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            transition: all 0.3s;
        }

        .time-slot:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.2);
        }

        .time-slot-header {
            font-size: 1.3em;
            font-weight: 700;
            color: white;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .weather-details {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .weather-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .weather-item .label {
            font-size: 0.95em;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .weather-item .value {
            font-size: 1.6em;
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .temperature {
            font-size: 3em !important;
            font-weight: 800 !important;
            background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .outfit-section h2 {
            text-align: center;
            color: white;
            margin-bottom: 35px;
            font-size: 2em;
            font-weight: 700;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .time-period-section {
            margin-bottom: 45px;
            animation: fadeIn 0.6s ease;
        }

        .time-period-section:last-child {
            margin-bottom: 0;
        }

        .time-period-header {
            font-size: 1.4em;
            font-weight: 700;
            color: white;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .outfit-carousel-container {
            position: relative;
            max-width: 400px;
            margin: 0 auto;
        }

        .outfit-carousel {
            position: relative;
            overflow: hidden;
            border-radius: 20px;
        }

        .outfit-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            display: none;
        }

        .outfit-card.active {
            display: block;
        }

        .carousel-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            transition: all 0.3s;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .carousel-button:hover:not(:disabled) {
            background: white;
            transform: translateY(-50%) scale(1.1);
        }

        .carousel-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .carousel-button.prev {
            left: -55px;
        }

        .carousel-button.next {
            right: -55px;
        }

        .carousel-indicators {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }

        .carousel-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transition: all 0.3s;
            cursor: pointer;
        }

        .carousel-indicator.active {
            background: white;
            width: 30px;
            border-radius: 5px;
        }

        .outfit-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25);
            background: rgba(255, 255, 255, 0.2);
        }

        .outfit-image {
            width: 100%;
            height: 320px;
            object-fit: cover;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            transition: transform 0.4s;
        }

        .outfit-card:hover .outfit-image {
            transform: scale(1.05);
        }

        .outfit-info {
            padding: 20px;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
        }

        .outfit-info h3 {
            color: white;
            margin-bottom: 8px;
            font-size: 1.1em;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .outfit-info p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95em;
            line-height: 1.5;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.2em;
            font-weight: 500;
        }

        .error {
            text-align: center;
            padding: 20px;
            background: rgba(255, 77, 77, 0.2);
            backdrop-filter: blur(10px);
            color: white;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 77, 77, 0.4);
            font-weight: 500;
        }

        .hidden {
            display: none;
        }

        /* ìƒì„¸ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
        }

        .detail-modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .detail-modal-content {
            background: white;
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .detail-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 35px;
            height: 35px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .detail-modal-close:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        .detail-modal-image {
            width: 100%;
            max-height: 500px;
            height: auto;
            object-fit: contain;
            border-radius: 20px 20px 0 0;
            background: #f5f5f7;
        }

        .detail-modal-body {
            padding: 30px;
        }

        .detail-modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .detail-modal-header h2 {
            color: #333;
            margin-bottom: 10px;
        }

        .detail-modal-header p {
            color: #666;
            margin-bottom: 5px;
        }

        /* ë³„ì  ì‹œìŠ¤í…œ */
        .rating-section {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .rating-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .star-rating {
            display: flex;
            justify-content: center;
            gap: 10px;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .star {
            cursor: pointer;
            color: #ddd;
            transition: color 0.2s, transform 0.2s;
        }

        .star:hover,
        .star.active {
            color: #ffd700;
            transform: scale(1.1);
        }

        .rating-display {
            color: #666;
            font-size: 0.9em;
        }

        /* ì°©ìš© ê¸°ë¡ ì„¹ì…˜ */
        .wear-history-section {
            margin-top: 20px;
        }

        .wear-history-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .add-wear-date {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .add-wear-date input[type="date"] {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 0.95em;
        }

        .add-wear-date button {
            padding: 10px 20px;
            white-space: nowrap;
        }

        .wear-history-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .wear-history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .wear-history-item .date {
            color: #333;
            font-weight: 500;
        }

        .wear-history-item .delete-btn {
            padding: 5px 12px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            margin: 0;
        }

        .wear-history-item .delete-btn:hover {
            background: #c82333;
            transform: none;
            box-shadow: none;
        }

        .empty-history {
            text-align: center;
            padding: 20px;
            color: #999;
            font-size: 0.9em;
        }

        /* í‰ì  ë°°ì§€ */
        .rating-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: rgba(255, 215, 0, 0.25);
            backdrop-filter: blur(5px);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 0.9em;
            margin-top: 8px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            font-weight: 600;
        }

        .rating-badge .star-icon {
            color: #ffd700;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
        }

        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            .header h1 {
                font-size: 2.5em;
            }

            .header p {
                font-size: 1.1em;
            }

            .card {
                padding: 20px;
            }

            .location-input {
                flex-direction: column;
                gap: 12px;
            }

            input[type="text"], select, button {
                width: 100%;
            }

            .weather-details {
                gap: 15px;
            }

            .time-slots {
                grid-template-columns: 1fr;
            }

            .outfit-grid {
                grid-template-columns: 1fr;
            }

            .detail-modal-content {
                max-height: 95vh;
                margin: 10px;
            }

            .detail-modal-image {
                height: 250px;
            }

            .detail-modal-body {
                padding: 20px;
            }

            .time-period-header {
                font-size: 1.2em;
                padding: 12px 16px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 2em;
            }

            .outfit-info h3 {
                font-size: 1em;
            }

            .outfit-image {
                height: 250px;
            }
        }
    </style>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="firebase-config.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ‘” ì˜¤ëŠ˜ ë­ì…ì§€?</h1>
            <p>ë‚ ì”¨ì— ë§ëŠ” ìŠ¤íƒ€ì¼ë§ì„ í™•ì¸í•˜ì„¸ìš”!</p>
            <div class="admin-link">
                <a href="admin.html">âš™ï¸ ê´€ë¦¬ì í˜ì´ì§€</a>
            </div>
        </div>

        <div class="card">
            <div class="location-section">
                <div class="location-input">
                    <select id="cityInput">
                        <option value="Seoul">ì„œìš¸</option>
                        <option value="Busan">ë¶€ì‚°</option>
                        <option value="Incheon">ì¸ì²œ</option>
                        <option value="Daegu">ëŒ€êµ¬</option>
                        <option value="Daejeon">ëŒ€ì „</option>
                        <option value="Gwangju">ê´‘ì£¼</option>
                        <option value="Ulsan">ìš¸ì‚°</option>
                    </select>
                    <button onclick="getWeather()">ë‚ ì”¨ í™•ì¸</button>
                    <button onclick="getCurrentLocation()">ë‚´ ìœ„ì¹˜</button>
                </div>

                <!-- ì‚¬ìš©ì ì„ í˜¸ë„ ì„¤ì • -->
                <div class="preference-section">
                    <div class="preference-label">ğŸŒ¡ï¸ ì˜·ì°¨ë¦¼ ì„ í˜¸ë„</div>
                    <div class="preference-toggle">
                        <button class="preference-btn" id="coolerBtn" onclick="setPreference('cooler')">
                            ë” ì‹œì›í•˜ê²Œ â„ï¸
                        </button>
                        <button class="preference-btn active" id="normalBtn" onclick="setPreference('normal')">
                            ë³´í†µ ğŸ‘
                        </button>
                        <button class="preference-btn" id="warmerBtn" onclick="setPreference('warmer')">
                            ë” ë”°ëœ»í•˜ê²Œ ğŸ”¥
                        </button>
                    </div>
                </div>
            </div>

            <div id="error" class="error hidden"></div>
            <div id="loading" class="loading hidden">ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>

            <div id="weatherOutfitSection" class="card hidden">
                <h2 id="cityName" style="text-align: center; color: white; margin-bottom: 20px; font-size: 2em;">-</h2>
                <div id="timeSlotContainer">
                    <!-- ì‹œê°„ëŒ€ë³„ ë‚ ì”¨ì™€ ì°©ìƒ·ì´ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒì„¸ ëª¨ë‹¬ -->
    <div id="detailModal" class="detail-modal" onclick="closeDetailModal(event)">
        <div class="detail-modal-content">
            <button class="detail-modal-close" onclick="closeDetailModal(event)">&times;</button>

            <img id="detailImage" class="detail-modal-image" src="" alt="">

            <div class="detail-modal-body">
                <div class="detail-modal-header">
                    <h2 id="detailTitle"></h2>
                    <p id="detailDescription"></p>
                    <p><strong id="detailTemp"></strong></p>
                </div>

                <!-- ë³„ì  ì„¹ì…˜ -->
                <div class="rating-section">
                    <h3>â­ ì´ ì°©ìƒ· í‰ê°€í•˜ê¸°</h3>
                    <div class="star-rating" id="starRating">
                        <span class="star" data-rating="1">â˜…</span>
                        <span class="star" data-rating="2">â˜…</span>
                        <span class="star" data-rating="3">â˜…</span>
                        <span class="star" data-rating="4">â˜…</span>
                        <span class="star" data-rating="5">â˜…</span>
                    </div>
                    <div class="rating-display" id="ratingDisplay">ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”</div>
                </div>

                <!-- ì°©ìš© ê¸°ë¡ ì„¹ì…˜ -->
                <div class="wear-history-section">
                    <h3>ğŸ“… ì°©ìš© ê¸°ë¡</h3>
                    <div class="add-wear-date">
                        <input type="date" id="wearDate">
                        <button onclick="addWearDate()">ê¸°ë¡ ì¶”ê°€</button>
                    </div>
                    <div class="wear-history-list" id="wearHistoryList">
                        <div class="empty-history">ì•„ì§ ì°©ìš© ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Open-Meteo API (ë¬´ë£Œ, API í‚¤ ë¶ˆí•„ìš”)

        // í˜„ì¬ ì„ íƒëœ ì°©ìƒ·
        let currentOutfit = null;

        // ì‚¬ìš©ì ì„ í˜¸ë„ (ê¸°ë³¸ê°’: normal)
        let userPreference = localStorage.getItem('clothingPreference') || 'normal';

        // ì„ í˜¸ë„ ì„¤ì • í•¨ìˆ˜
        function setPreference(preference) {
            userPreference = preference;
            localStorage.setItem('clothingPreference', preference);

            // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.preference-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            if (preference === 'cooler') {
                document.getElementById('coolerBtn').classList.add('active');
            } else if (preference === 'warmer') {
                document.getElementById('warmerBtn').classList.add('active');
            } else {
                document.getElementById('normalBtn').classList.add('active');
            }

            // ì´ë¯¸ ë‚ ì”¨ ì •ë³´ê°€ í‘œì‹œë˜ì–´ ìˆë‹¤ë©´ ë‹¤ì‹œ ë¡œë“œ
            if (!document.getElementById('weatherInfo').classList.contains('hidden')) {
                getWeather();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ì„ í˜¸ë„ ì ìš©
        function loadUserPreference() {
            setPreference(userPreference);
        }

        // ì£¼ìš°ì¬ ì°©ìƒ· ë°ì´í„°ë² ì´ìŠ¤ (ìƒ˜í”Œ) - ì„¸ë¶„í™”ëœ ì˜¨ë„ ê¸°ì¤€
        const outfitDatabase = {
            veryhot: [ // 28ë„ ì´ìƒ
                {
                    title: 'ì„œë¨¸ ë¦°ë„¨ ë£©',
                    description: 'ë¦°ë„¨ ì…”ì¸  + ìˆíŒ¬ì¸ ',
                    image: 'https://via.placeholder.com/300x400/FFF8DC/000000?text=%EC%84%9C%EB%A8%B8+%EB%A6%B0%EB%84%A8',
                    temp: '28Â°C+'
                }
            ],
            hot: [ // 23-28ë„
                {
                    title: 'ì—¬ë¦„ í™”ì´íŠ¸ ì…”ì¸  ë£©',
                    description: 'ì‹œì›í•œ í™”ì´íŠ¸ ì…”ì¸  + ë² ì´ì§€ íŒ¬ì¸ ',
                    image: 'https://via.placeholder.com/300x400/FFE4B5/000000?text=%EC%97%AC%EB%A6%84+%ED%99%94%EC%9D%B4%ED%8A%B8+%EB%A3%A9',
                    temp: '23-28Â°C'
                },
                {
                    title: 'ìºì£¼ì–¼ í‹°ì…”ì¸  ë£©',
                    description: 'ë¸”ë™ í‹°ì…”ì¸  + ë°ë‹˜ íŒ¬ì¸ ',
                    image: 'https://via.placeholder.com/300x400/87CEEB/000000?text=%EC%BA%90%EC%A5%AC%EC%96%BC+%ED%8B%B0%EC%85%94%EC%B8%A0',
                    temp: '23-28Â°C'
                }
            ],
            warm: [ // 20-23ë„
                {
                    title: 'ë´„ ê°€ë””ê±´ ë£©',
                    description: 'ê°€ë””ê±´ + í™”ì´íŠ¸í‹° + ìŠ¬ë™ìŠ¤',
                    image: 'https://via.placeholder.com/300x400/FFB6C1/000000?text=%EB%B4%84+%EA%B0%80%EB%94%94%EA%B1%B4',
                    temp: '20-23Â°C'
                }
            ],
            mild: [ // 17-20ë„
                {
                    title: 'ì…”ì¸  ë ˆì´ì–´ë“œ ë£©',
                    description: 'ì²´í¬ ì…”ì¸  + ì²­ë°”ì§€',
                    image: 'https://via.placeholder.com/300x400/DDA0DD/000000?text=%EC%85%94%EC%B8%A0+%EB%A0%88%EC%9D%B4%EC%96%B4%EB%93%9C',
                    temp: '17-20Â°C'
                },
                {
                    title: 'ë‹ˆíŠ¸ ìºì£¼ì–¼ ë£©',
                    description: 'ì–‡ì€ ë‹ˆíŠ¸ + ì¹˜ë…¸íŒ¬ì¸ ',
                    image: 'https://via.placeholder.com/300x400/F0E68C/000000?text=%EB%8B%88%ED%8A%B8+%EC%BA%90%EC%A5%AC%EC%96%BC',
                    temp: '17-20Â°C'
                }
            ],
            cool: [ // 12-17ë„
                {
                    title: 'íŠ¸ë Œì¹˜ ì½”íŠ¸ ë£©',
                    description: 'íŠ¸ë Œì¹˜ ì½”íŠ¸ + ë‹ˆíŠ¸ + ìŠ¬ë™ìŠ¤',
                    image: 'https://via.placeholder.com/300x400/D2B48C/000000?text=%ED%8A%B8%EB%A0%8C%EC%B9%98+%EC%BD%94%ED%8A%B8',
                    temp: '12-17Â°C'
                },
                {
                    title: 'ìì¼“ ë ˆì´ì–´ë“œ ë£©',
                    description: 'ì¬í‚· + í›„ë“œí‹° + ì²­ë°”ì§€',
                    image: 'https://via.placeholder.com/300x400/BC8F8F/000000?text=%EC%9E%90%EC%BC%93+%EB%A0%88%EC%9D%B4%EC%96%B4%EB%93%9C',
                    temp: '12-17Â°C'
                }
            ],
            cold: [ // 7-12ë„
                {
                    title: 'ê°€ì„ ìš¸ ì½”íŠ¸ ë£©',
                    description: 'ìš¸ ì½”íŠ¸ + í„°í‹€ë„¥',
                    image: 'https://via.placeholder.com/300x400/A0522D/000000?text=%EA%B0%80%EC%9D%84+%EC%9A%B8+%EC%BD%94%ED%8A%B8',
                    temp: '7-12Â°C'
                }
            ],
            verycold: [ // 3-7ë„
                {
                    title: 'ìˆíŒ¨ë”© ìºì£¼ì–¼ ë£©',
                    description: 'ìˆíŒ¨ë”© + í›„ë“œ + ì²­ë°”ì§€',
                    image: 'https://via.placeholder.com/300x400/2F4F4F/FFFFFF?text=%EC%88%8F%ED%8C%A8%EB%94%A9+%EC%BA%90%EC%A5%AC%EC%96%BC',
                    temp: '3-7Â°C'
                },
                {
                    title: 'ê²¨ìš¸ ì½”íŠ¸ í¬ë©€ ë£©',
                    description: 'ìš¸ ì½”íŠ¸ + ë‹ˆíŠ¸ + ìŠ¬ë™ìŠ¤',
                    image: 'https://via.placeholder.com/300x400/191970/FFFFFF?text=%EA%B2%A8%EC%9A%B8+%EC%BD%94%ED%8A%B8',
                    temp: '3-7Â°C'
                }
            ],
            freezing: [ // 3ë„ ì´í•˜
                {
                    title: 'ê²¨ìš¸ ë¡±íŒ¨ë”© ë£©',
                    description: 'ë¡±íŒ¨ë”© + ëª©ë„ë¦¬ + ê¸°ëª¨ íŒ¬ì¸ ',
                    image: 'https://via.placeholder.com/300x400/4682B4/FFFFFF?text=%EA%B2%A8%EC%9A%B8+%EB%A1%B1%ED%8C%A8%EB%94%A9',
                    temp: '3Â°C ì´í•˜'
                }
            ],
            rainy: [ // ë¹„ì˜¤ëŠ” ë‚ 
                {
                    title: 'ë ˆì¸ ì¬í‚· ë£©',
                    description: 'ë ˆì¸ ì¬í‚· + ë°©ìˆ˜ íŒ¬ì¸ ',
                    image: 'https://via.placeholder.com/300x400/708090/FFFFFF?text=%EB%A0%88%EC%9D%B8+%EC%9E%AC%ED%82%B7',
                    temp: 'ë¹„ì˜¤ëŠ” ë‚ '
                },
                {
                    title: 'íŠ¸ë Œì¹˜ ì½”íŠ¸ ìš°ì²œ ë£©',
                    description: 'ë°©ìˆ˜ íŠ¸ë Œì¹˜ + ìš°ì‚°',
                    image: 'https://via.placeholder.com/300x400/778899/FFFFFF?text=%ED%8A%B8%EB%A0%8C%EC%B9%98+%EC%9A%B0%EC%B2%9C',
                    temp: 'ë¹„ì˜¤ëŠ” ë‚ '
                }
            ]
        };

        // Firebaseì—ì„œ ì°©ìƒ· ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function getOutfitsFromStorage() {
            try {
                const allOutfits = await getAllOutfitsFromFirestore();

                if (allOutfits && allOutfits.length > 0) {
                    // Firestore ë°ì´í„°ë¥¼ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê·¸ë£¹í™”
                    const grouped = {};
                    allOutfits.forEach(outfit => {
                        if (!grouped[outfit.category]) {
                            grouped[outfit.category] = [];
                        }
                        grouped[outfit.category].push(outfit);
                    });
                    return grouped;
                }
            } catch (e) {
                console.error('Firestore ì½ê¸° ì˜¤ë¥˜:', e);
            }

            // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¹ˆ ê°ì²´ ë°˜í™˜
            return outfitDatabase;
        }

        // ë‚ ì”¨ì— ë”°ë¥¸ ì°©ìƒ· ë§¤ì¹­ í•¨ìˆ˜ (ì„¸ë¶„í™”ëœ 8ë‹¨ê³„)
        async function getOutfitsByWeather(temp, weatherMain) {
            const database = await getOutfitsFromStorage();

            // ë¹„ê°€ ì˜¤ëŠ” ê²½ìš°
            if (weatherMain.toLowerCase().includes('rain')) {
                return database.rainy || [];
            }

            // ì‚¬ìš©ì ì„ í˜¸ë„ì— ë”°ë¼ ì˜¨ë„ ì¡°ì •
            let adjustedTemp = temp;
            if (userPreference === 'cooler') {
                // ë” ì‹œì›í•˜ê²Œ ì…ê³  ì‹¶ìœ¼ë©´ ì˜¨ë„ë¥¼ +3ë„ë¡œ ì¡°ì • (ë” ë”ìš´ ê²ƒì²˜ëŸ¼)
                adjustedTemp = temp + 3;
            } else if (userPreference === 'warmer') {
                // ë” ë”°ëœ»í•˜ê²Œ ì…ê³  ì‹¶ìœ¼ë©´ ì˜¨ë„ë¥¼ -3ë„ë¡œ ì¡°ì • (ë” ì¶”ìš´ ê²ƒì²˜ëŸ¼)
                adjustedTemp = temp - 3;
            }

            // ì„¸ë¶„í™”ëœ ì˜¨ë„ë³„ ë§¤ì¹­ (8ë‹¨ê³„)
            if (adjustedTemp >= 28) {
                // 28ë„ ì´ìƒ: ë§¤ìš° ë”ìš´ ì—¬ë¦„ (ë°˜íŒ”, ë°˜ë°”ì§€, ë¦°ë„¨)
                return database.veryhot || database.hot || [];
            } else if (adjustedTemp >= 23) {
                // 23-28ë„: ë”ìš´ ë‚ ì”¨ (ë°˜íŒ”, ì–‡ì€ ì…”ì¸ )
                return database.hot || database.veryhot || [];
            } else if (adjustedTemp >= 20) {
                // 20-23ë„: ë”°ëœ»í•œ ë‚ ì”¨ (ê¸´íŒ” í‹°ì…”ì¸ , ì–‡ì€ ê°€ë””ê±´)
                return database.warm || database.hot || [];
            } else if (adjustedTemp >= 17) {
                // 17-20ë„: ì„ ì„ í•œ ë‚ ì”¨ (ê°€ë””ê±´, ì–‡ì€ ì¬í‚·)
                return database.mild || database.warm || [];
            } else if (adjustedTemp >= 12) {
                // 12-17ë„: ìŒ€ìŒ€í•œ ë‚ ì”¨ (ì¬í‚·, ë‹ˆíŠ¸)
                return database.cool || database.mild || [];
            } else if (adjustedTemp >= 7) {
                // 7-12ë„: ì¶”ìš´ ë‚ ì”¨ (ì½”íŠ¸, ë‘êº¼ìš´ ì¬í‚·)
                return database.cold || database.cool || [];
            } else if (adjustedTemp >= 3) {
                // 3-7ë„: ë§¤ìš° ì¶”ìš´ ë‚ ì”¨ (íŒ¨ë”©, ë‘êº¼ìš´ ì½”íŠ¸)
                return database.verycold || database.cold || [];
            } else {
                // 3ë„ ì´í•˜: í•œíŒŒ (ë¡±íŒ¨ë”©, ëª©ë„ë¦¬, ê¸°ëª¨)
                return database.freezing || database.verycold || [];
            }
        }

        // ë„ì‹œ ì´ë¦„ì„ ì¢Œí‘œë¡œ ë³€í™˜
        async function getCityCoordinates(city) {
            const cityCoords = {
                'Seoul': { lat: 37.5665, lon: 126.9780, name: 'ì„œìš¸' },
                'Busan': { lat: 35.1796, lon: 129.0756, name: 'ë¶€ì‚°' },
                'Incheon': { lat: 37.4563, lon: 126.7052, name: 'ì¸ì²œ' },
                'Daegu': { lat: 35.8714, lon: 128.6014, name: 'ëŒ€êµ¬' },
                'Daejeon': { lat: 36.3504, lon: 127.3845, name: 'ëŒ€ì „' },
                'Gwangju': { lat: 35.1595, lon: 126.8526, name: 'ê´‘ì£¼' },
                'Ulsan': { lat: 35.5384, lon: 129.3114, name: 'ìš¸ì‚°' }
            };

            const cityLower = city.toLowerCase();
            for (const [key, value] of Object.entries(cityCoords)) {
                if (key.toLowerCase() === cityLower) {
                    return value;
                }
            }

            // ê¸°ë³¸ê°’: ì„œìš¸
            return cityCoords['Seoul'];
        }

        // ë‚ ì”¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        async function getWeather() {
            const city = document.getElementById('cityInput').value.trim();

            if (!city) {
                showError('ë„ì‹œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            showLoading(true);
            hideError();

            try {
                const coords = await getCityCoordinates(city);

                // Open-Meteo API í˜¸ì¶œ (ì‹œê°„ë³„ ì˜ˆë³´)
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&hourly=temperature_2m,apparent_temperature,weather_code&timezone=Asia/Seoul&forecast_days=1`;
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error('ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

                const data = await response.json();

                // ì˜¤ëŠ˜ ë‚ ì§œì˜ íŠ¹ì • ì‹œê°„(7ì‹œ, 13ì‹œ, 19ì‹œ) ë°ì´í„° ì¶”ì¶œ
                const timeSlots = extractTimeSlots(data.hourly, coords.name);

                displayWeatherTimeSlots(timeSlots);
            } catch (error) {
                showError(error.message);
            } finally {
                showLoading(false);
            }
        }

        // ì‹œê°„ëŒ€ë³„ ë‚ ì”¨ ë°ì´í„° ì¶”ì¶œ
        function extractTimeSlots(hourlyData, cityName) {
            const now = new Date();
            const targetHours = [7, 13, 19]; // ì˜¤ì „ 7ì‹œ, ì˜¤í›„ 1ì‹œ, ì˜¤í›„ 7ì‹œ
            const slots = [];

            targetHours.forEach(targetHour => {
                // ì˜¤ëŠ˜ ë‚ ì§œì˜ í•´ë‹¹ ì‹œê°„ ì¸ë±ìŠ¤ ì°¾ê¸°
                const targetTime = new Date(now);
                targetTime.setHours(targetHour, 0, 0, 0);

                // hourlyData.timeì—ì„œ í•´ë‹¹ ì‹œê°„ ì°¾ê¸°
                const timeIndex = hourlyData.time.findIndex(time => {
                    const date = new Date(time);
                    return date.getHours() === targetHour &&
                           date.getDate() === now.getDate();
                });

                if (timeIndex !== -1) {
                    const temp = hourlyData.temperature_2m[timeIndex];
                    const feelsLike = hourlyData.apparent_temperature[timeIndex];
                    const weatherCode = hourlyData.weather_code[timeIndex];

                    slots.push({
                        hour: targetHour,
                        label: targetHour === 7 ? 'ì˜¤ì „ 7ì‹œ â˜€ï¸' :
                               targetHour === 13 ? 'ì˜¤í›„ 1ì‹œ ğŸŒ¤ï¸' : 'ì˜¤í›„ 7ì‹œ ğŸŒ™',
                        cityName: cityName,
                        temp: temp,
                        feelsLike: feelsLike,
                        weatherMain: getWeatherType(weatherCode),
                        weatherDesc: getWeatherDescription(weatherCode)
                    });
                }
            });

            return slots;
        }

        // WMO ë‚ ì”¨ ì½”ë“œë¥¼ ë‚ ì”¨ íƒ€ì…ìœ¼ë¡œ ë³€í™˜
        function getWeatherType(code) {
            if (code === 0) return 'Clear';
            if (code <= 3) return 'Clouds';
            if (code >= 51 && code <= 67) return 'Rain';
            if (code >= 71 && code <= 77) return 'Snow';
            if (code >= 80 && code <= 82) return 'Rain';
            if (code >= 85 && code <= 86) return 'Snow';
            if (code >= 95) return 'Thunderstorm';
            return 'Clouds';
        }

        // WMO ë‚ ì”¨ ì½”ë“œë¥¼ í•œê¸€ ì„¤ëª…ìœ¼ë¡œ ë³€í™˜
        function getWeatherDescription(code) {
            const descriptions = {
                0: 'ë§‘ìŒ',
                1: 'ëŒ€ì²´ë¡œ ë§‘ìŒ',
                2: 'ë¶€ë¶„ì ìœ¼ë¡œ íë¦¼',
                3: 'íë¦¼',
                45: 'ì•ˆê°œ',
                48: 'ì•ˆê°œ',
                51: 'ê°€ë²¼ìš´ ì´ìŠ¬ë¹„',
                53: 'ì´ìŠ¬ë¹„',
                55: 'ê°•í•œ ì´ìŠ¬ë¹„',
                61: 'ì•½í•œ ë¹„',
                63: 'ë¹„',
                65: 'ê°•í•œ ë¹„',
                71: 'ì•½í•œ ëˆˆ',
                73: 'ëˆˆ',
                75: 'ê°•í•œ ëˆˆ',
                80: 'ì†Œë‚˜ê¸°',
                81: 'ê°•í•œ ì†Œë‚˜ê¸°',
                82: 'ë§¤ìš° ê°•í•œ ì†Œë‚˜ê¸°',
                95: 'ë‡Œìš°',
                96: 'ìš°ë°•ì„ ë™ë°˜í•œ ë‡Œìš°',
                99: 'ê°•í•œ ìš°ë°•ì„ ë™ë°˜í•œ ë‡Œìš°'
            };
            return descriptions[code] || 'ì•Œ ìˆ˜ ì—†ìŒ';
        }

        // ë‚ ì”¨ì— ë”°ë¥¸ ë°°ê²½ ì—…ë°ì´íŠ¸
        function updateBackground(weatherMain) {
            const body = document.body;
            const now = new Date();
            const hour = now.getHours();
            const isNight = hour < 6 || hour >= 19;

            // ê¸°ì¡´ í´ë˜ìŠ¤ ëª¨ë‘ ì œê±°
            body.className = '';

            // ë‚ ì”¨ì™€ ì‹œê°„ì— ë”°ë¼ ë°°ê²½ ì„¤ì •
            if (weatherMain === 'Clear') {
                body.classList.add(isNight ? 'weather-clear-night' : 'weather-clear-day');
            } else if (weatherMain === 'Clouds') {
                body.classList.add(isNight ? 'weather-clouds-night' : 'weather-clouds-day');
            } else if (weatherMain === 'Rain' || weatherMain === 'Thunderstorm') {
                body.classList.add('weather-rain');
            } else if (weatherMain === 'Snow') {
                body.classList.add('weather-snow');
            } else {
                body.classList.add('weather-default');
            }
        }

        // í˜„ì¬ ìœ„ì¹˜ ë‚ ì”¨ ê°€ì ¸ì˜¤ê¸°
        function getCurrentLocation() {
            if (!navigator.geolocation) {
                showError('ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
                return;
            }

            showLoading(true);
            hideError();

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    try {
                        const { latitude, longitude } = position.coords;

                        // Open-Meteo API í˜¸ì¶œ (ì‹œê°„ë³„ ì˜ˆë³´)
                        const url = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&hourly=temperature_2m,apparent_temperature,weather_code&timezone=Asia/Seoul&forecast_days=1`;
                        const response = await fetch(url);

                        if (!response.ok) {
                            throw new Error('ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        }

                        const data = await response.json();

                        // ì˜¤ëŠ˜ ë‚ ì§œì˜ íŠ¹ì • ì‹œê°„(7ì‹œ, 13ì‹œ, 19ì‹œ) ë°ì´í„° ì¶”ì¶œ
                        const timeSlots = extractTimeSlots(data.hourly, 'í˜„ì¬ ìœ„ì¹˜');

                        displayWeatherTimeSlots(timeSlots);
                    } catch (error) {
                        showError(error.message);
                    } finally {
                        showLoading(false);
                    }
                },
                (error) => {
                    showError('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìœ„ì¹˜ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    showLoading(false);
                }
            );
        }

        // ì‹œê°„ëŒ€ë³„ ë‚ ì”¨ ì •ë³´ ë° ì°©ìƒ· í‘œì‹œ
        async function displayWeatherTimeSlots(timeSlots) {
            const cityName = timeSlots.length > 0 ? timeSlots[0].cityName : '-';
            document.getElementById('cityName').textContent = cityName;

            // í˜„ì¬ ì‹œê°„ëŒ€ì˜ ë‚ ì”¨ë¡œ ë°°ê²½ ì—…ë°ì´íŠ¸
            if (timeSlots.length > 0) {
                const currentHour = new Date().getHours();
                let currentSlot = timeSlots[0];

                // í˜„ì¬ ì‹œê°„ê³¼ ê°€ì¥ ê°€ê¹Œìš´ ì‹œê°„ëŒ€ ì°¾ê¸°
                for (const slot of timeSlots) {
                    if (Math.abs(slot.hour - currentHour) < Math.abs(currentSlot.hour - currentHour)) {
                        currentSlot = slot;
                    }
                }

                updateBackground(currentSlot.weatherMain);
            }

            // í†µí•©ëœ ì‹œê°„ëŒ€ë³„ ë‚ ì”¨ì™€ ì°©ìƒ· í‘œì‹œ
            await displayCombinedTimeSlots(timeSlots);

            document.getElementById('weatherOutfitSection').classList.remove('hidden');
        }

        // ì‹œê°„ëŒ€ë³„ ë‚ ì”¨ì™€ ì°©ìƒ·ì„ í†µí•©í•´ì„œ í‘œì‹œ
        async function displayCombinedTimeSlots(timeSlots) {
            const container = document.getElementById('timeSlotContainer');
            container.innerHTML = '';

            for (const slot of timeSlots) {
                // ê° ì‹œê°„ëŒ€ë³„ ì„¹ì…˜ ìƒì„±
                const section = document.createElement('div');
                section.style.cssText = 'background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 20px; margin-bottom: 20px;';

                // ì‹œê°„ëŒ€ í—¤ë” (ë‚ ì”¨ ì •ë³´ í¬í•¨)
                const header = document.createElement('div');
                header.style.cssText = 'color: white; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 2px solid rgba(255, 255, 255, 0.2);';
                header.innerHTML = `
                    <h3 style="font-size: 1.8em; margin-bottom: 10px;">${slot.label}</h3>
                    <div style="display: flex; gap: 30px; flex-wrap: wrap; font-size: 1.1em;">
                        <div><strong>ì˜¨ë„:</strong> ${Math.round(slot.temp)}Â°C</div>
                        <div><strong>ì²´ê°:</strong> ${Math.round(slot.feelsLike)}Â°C</div>
                        <div><strong>ë‚ ì”¨:</strong> ${slot.weatherDesc}</div>
                    </div>
                `;
                section.appendChild(header);

                // ì°©ìƒ· ì¶”ì²œ
                const outfits = await getOutfitsByWeather(slot.temp, slot.weatherMain);

                if (outfits.length === 0) {
                    const emptyMsg = document.createElement('div');
                    emptyMsg.style.cssText = 'text-align: center; padding: 40px; color: rgba(255, 255, 255, 0.7);';
                    emptyMsg.innerHTML = `
                        <p>ì´ ë‚ ì”¨ì— ë§ëŠ” ì°©ìƒ·ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p><a href="admin.html" style="color: #a8d5ff;">ê´€ë¦¬ì í˜ì´ì§€</a>ì—ì„œ ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>
                    `;
                    section.appendChild(emptyMsg);
                } else {
                    // ìºëŸ¬ì…€ ìƒì„±
                    const carouselContainer = createOutfitCarousel(outfits, slot);
                    section.appendChild(carouselContainer);
                }

                container.appendChild(section);
            }
        }

        // ì°©ìƒ· ìºëŸ¬ì…€ ìƒì„±
        function createOutfitCarousel(outfits, slot) {
            const container = document.createElement('div');
            container.className = 'outfit-carousel-container';

            // ì°©ìƒ·ì„ ì„ì–´ì„œ ìµœëŒ€ 3ê°œë§Œ ì‚¬ìš©
            const shuffledOutfits = shuffleArray(outfits).slice(0, 3);
            let currentIndex = 0;

            // ìºëŸ¬ì…€ ë˜í¼
            const carousel = document.createElement('div');
            carousel.className = 'outfit-carousel';

            // ì´ì „ ë²„íŠ¼
            const prevBtn = document.createElement('button');
            prevBtn.className = 'carousel-button prev';
            prevBtn.innerHTML = 'â€¹';
            prevBtn.onclick = () => {
                currentIndex = Math.max(0, currentIndex - 1);
                updateCarousel();
            };

            // ë‹¤ìŒ ë²„íŠ¼
            const nextBtn = document.createElement('button');
            nextBtn.className = 'carousel-button next';
            nextBtn.innerHTML = 'â€º';
            nextBtn.onclick = () => {
                currentIndex = Math.min(shuffledOutfits.length - 1, currentIndex + 1);
                updateCarousel();
            };

            // ì°©ìƒ· ì¹´ë“œë“¤ ìƒì„±
            shuffledOutfits.forEach((outfit, index) => {
                const card = document.createElement('div');
                card.className = `outfit-card ${index === 0 ? 'active' : ''}`;

                const ratingBadge = outfit.rating && outfit.rating > 0
                    ? `<div class="rating-badge"><span class="star-icon">â˜…</span> ${outfit.rating}/5</div>`
                    : '';

                const wearCount = outfit.wearHistory && outfit.wearHistory.length > 0
                    ? `<p style="font-size: 0.85em; color: #999; margin-top: 5px;">ğŸ‘” ${outfit.wearHistory.length}íšŒ ì°©ìš©</p>`
                    : '';

                card.innerHTML = `
                    <img src="${outfit.image}" alt="${outfit.title}" class="outfit-image">
                    <div class="outfit-info">
                        <h3>${outfit.title}</h3>
                        <p>${outfit.description}</p>
                        <p><strong>${outfit.temp}</strong></p>
                        ${ratingBadge}
                        ${wearCount}
                    </div>
                `;

                card.addEventListener('click', () => openDetailModal(outfit));
                carousel.appendChild(card);
            });

            // ì¸ë””ì¼€ì´í„°
            const indicators = document.createElement('div');
            indicators.className = 'carousel-indicators';

            shuffledOutfits.forEach((_, index) => {
                const indicator = document.createElement('div');
                indicator.className = `carousel-indicator ${index === 0 ? 'active' : ''}`;
                indicator.onclick = () => {
                    currentIndex = index;
                    updateCarousel();
                };
                indicators.appendChild(indicator);
            });

            // ìºëŸ¬ì…€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            function updateCarousel() {
                // ì¹´ë“œ ì—…ë°ì´íŠ¸
                const cards = carousel.querySelectorAll('.outfit-card');
                cards.forEach((card, index) => {
                    card.classList.toggle('active', index === currentIndex);
                });

                // ì¸ë””ì¼€ì´í„° ì—…ë°ì´íŠ¸
                const indicatorDots = indicators.querySelectorAll('.carousel-indicator');
                indicatorDots.forEach((dot, index) => {
                    dot.classList.toggle('active', index === currentIndex);
                });

                // ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
                prevBtn.disabled = currentIndex === 0;
                nextBtn.disabled = currentIndex === shuffledOutfits.length - 1;
            }

            container.appendChild(prevBtn);
            container.appendChild(carousel);
            container.appendChild(nextBtn);
            container.appendChild(indicators);

            // ì´ˆê¸° ìƒíƒœ ì„¤ì •
            updateCarousel();

            return container;
        }

        // ë°°ì—´ ì„ê¸° í•¨ìˆ˜ (Fisher-Yates shuffle)
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function showLoading(show) {
            document.getElementById('loading').classList.toggle('hidden', !show);
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function hideError() {
            document.getElementById('error').classList.add('hidden');
        }

        // ì—”í„° í‚¤ë¡œ ê²€ìƒ‰
        document.getElementById('cityInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                getWeather();
            }
        });

        // Firebase ì°©ìƒ· ì—…ë°ì´íŠ¸ (ë³„ì , ì°©ìš© ê¸°ë¡ ë“±)
        async function updateOutfitInDB(outfit) {
            return await updateOutfitInFirestore(outfit);
        }

        // Firebaseì—ì„œ íŠ¹ì • ì°©ìƒ· ê°€ì ¸ì˜¤ê¸°
        async function getOutfitFromDB(id) {
            return await getOutfitFromFirestore(id);
        }

        // ìƒì„¸ ëª¨ë‹¬ ì—´ê¸°
        async function openDetailModal(outfit) {
            currentOutfit = outfit;

            // ë°ì´í„° ì´ˆê¸°í™” (ì—†ìœ¼ë©´ ì¶”ê°€)
            if (!currentOutfit.rating) {
                currentOutfit.rating = 0;
            }
            if (!currentOutfit.wearHistory) {
                currentOutfit.wearHistory = [];
            }

            // ëª¨ë‹¬ ë‚´ìš© ì±„ìš°ê¸°
            document.getElementById('detailImage').src = outfit.image;
            document.getElementById('detailTitle').textContent = outfit.title;
            document.getElementById('detailDescription').textContent = outfit.description;
            document.getElementById('detailTemp').textContent = outfit.temp;

            // ë³„ì  í‘œì‹œ
            updateStarDisplay(currentOutfit.rating);

            // ì°©ìš© ê¸°ë¡ í‘œì‹œ
            updateWearHistoryDisplay();

            // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('wearDate').value = today;

            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('detailModal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        // ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
        function closeDetailModal(event) {
            if (event.target.id === 'detailModal' || event.target.className === 'detail-modal-close') {
                document.getElementById('detailModal').classList.remove('show');
                document.body.style.overflow = 'auto';
                currentOutfit = null;
            }
        }

        // ë³„ì  í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateStarDisplay(rating) {
            const stars = document.querySelectorAll('#starRating .star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });

            const ratingDisplay = document.getElementById('ratingDisplay');
            if (rating > 0) {
                ratingDisplay.textContent = `${rating}ì  / 5ì `;
            } else {
                ratingDisplay.textContent = 'ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”';
            }
        }

        // ë³„ì  í´ë¦­ ì´ë²¤íŠ¸
        document.querySelectorAll('#starRating .star').forEach(star => {
            star.addEventListener('click', async function() {
                if (!currentOutfit) return;

                const rating = parseInt(this.getAttribute('data-rating'));
                currentOutfit.rating = rating;

                // ë³„ì  í‘œì‹œ ì—…ë°ì´íŠ¸
                updateStarDisplay(rating);

                // DBì— ì €ì¥ (IDê°€ ìˆëŠ” ê²½ìš°ë§Œ)
                if (currentOutfit.id) {
                    try {
                        await updateOutfitInDB(currentOutfit);
                    } catch (error) {
                        console.error('ë³„ì  ì €ì¥ ì˜¤ë¥˜:', error);
                    }
                }
            });
        });

        // ì°©ìš© ê¸°ë¡ ì¶”ê°€
        async function addWearDate() {
            if (!currentOutfit) return;

            const dateInput = document.getElementById('wearDate');
            const date = dateInput.value;

            if (!date) {
                alert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì°©ìš© ê¸°ë¡ ë°°ì—´ ì´ˆê¸°í™” (ì—†ìœ¼ë©´)
            if (!currentOutfit.wearHistory) {
                currentOutfit.wearHistory = [];
            }

            // ì¤‘ë³µ í™•ì¸
            if (currentOutfit.wearHistory.includes(date)) {
                alert('ì´ë¯¸ ì¶”ê°€ëœ ë‚ ì§œì…ë‹ˆë‹¤.');
                return;
            }

            // ì°©ìš© ê¸°ë¡ ì¶”ê°€
            currentOutfit.wearHistory.push(date);
            currentOutfit.wearHistory.sort().reverse(); // ìµœì‹ ìˆœ ì •ë ¬

            // í‘œì‹œ ì—…ë°ì´íŠ¸
            updateWearHistoryDisplay();

            // DBì— ì €ì¥ (IDê°€ ìˆëŠ” ê²½ìš°ë§Œ)
            if (currentOutfit.id) {
                try {
                    await updateOutfitInDB(currentOutfit);
                } catch (error) {
                    console.error('ì°©ìš© ê¸°ë¡ ì €ì¥ ì˜¤ë¥˜:', error);
                }
            }
        }

        // ì°©ìš© ê¸°ë¡ ì‚­ì œ
        async function deleteWearDate(date) {
            if (!currentOutfit) return;

            if (!confirm('ì´ ì°©ìš© ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            // ì°©ìš© ê¸°ë¡ì—ì„œ ì œê±°
            currentOutfit.wearHistory = currentOutfit.wearHistory.filter(d => d !== date);

            // í‘œì‹œ ì—…ë°ì´íŠ¸
            updateWearHistoryDisplay();

            // DBì— ì €ì¥ (IDê°€ ìˆëŠ” ê²½ìš°ë§Œ)
            if (currentOutfit.id) {
                try {
                    await updateOutfitInDB(currentOutfit);
                } catch (error) {
                    console.error('ì°©ìš© ê¸°ë¡ ì‚­ì œ ì˜¤ë¥˜:', error);
                }
            }
        }

        // ì°©ìš© ê¸°ë¡ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateWearHistoryDisplay() {
            const container = document.getElementById('wearHistoryList');

            if (!currentOutfit.wearHistory || currentOutfit.wearHistory.length === 0) {
                container.innerHTML = '<div class="empty-history">ì•„ì§ ì°©ìš© ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            container.innerHTML = '';
            currentOutfit.wearHistory.forEach(date => {
                const item = document.createElement('div');
                item.className = 'wear-history-item';

                // ë‚ ì§œ í¬ë§· ë³€í™˜ (YYYY-MM-DD -> YYYYë…„ MMì›” DDì¼)
                const [year, month, day] = date.split('-');
                const formattedDate = `${year}ë…„ ${month}ì›” ${day}ì¼`;

                item.innerHTML = `
                    <span class="date">${formattedDate}</span>
                    <button class="delete-btn" onclick="deleteWearDate('${date}')">ì‚­ì œ</button>
                `;
                container.appendChild(item);
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” ë° ê¸°ë³¸ ë‚ ì”¨ í‘œì‹œ
        window.addEventListener('load', async () => {
            loadUserPreference();  // ì‚¬ìš©ì ì„ í˜¸ë„ ë¡œë“œ
            getWeather();
        });

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = document.getElementById('detailModal');
                if (modal.classList.contains('show')) {
                    modal.classList.remove('show');
                    document.body.style.overflow = 'auto';
                    currentOutfit = null;
                }
            }
        });
    </script>
</body>
</html>
