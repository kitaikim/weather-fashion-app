<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ - ì°©ìƒ· ê´€ë¦¬</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="firebase-config.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .nav-buttons {
            text-align: center;
            margin-bottom: 20px;
        }

        .nav-buttons a {
            display: inline-block;
            padding: 10px 20px;
            background: white;
            color: #667eea;
            text-decoration: none;
            border-radius: 10px;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .nav-buttons a:hover {
            transform: translateY(-2px);
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .form-section h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #333;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            transition: border 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .image-upload-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .upload-option {
            border: 2px dashed #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: border 0.3s;
        }

        .upload-option:hover {
            border-color: #667eea;
        }

        .upload-option h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            display: inline-block;
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .file-input-label:hover {
            background: #5568d3;
        }

        .preview-area {
            margin-top: 15px;
            min-height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .preview-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
        }

        button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button.secondary {
            background: #6c757d;
        }

        button.danger {
            background: #dc3545;
        }

        .outfit-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .outfit-item {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            background: white;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .outfit-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .outfit-item img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            background: #f0f0f0;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .outfit-item img:hover {
            transform: scale(1.05);
        }

        .outfit-item-info {
            padding: 15px;
        }

        .outfit-item-info h3 {
            color: #333;
            margin-bottom: 5px;
            font-size: 1em;
        }

        .outfit-item-info p {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .outfit-item-info .category {
            display: inline-block;
            padding: 4px 10px;
            background: #667eea;
            color: white;
            border-radius: 5px;
            font-size: 0.8em;
            margin-bottom: 10px;
        }

        .outfit-item-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .outfit-item-actions button {
            flex: 1;
            padding: 8px;
            margin: 0;
            font-size: 0.9em;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        /* í•„í„° ë° ì •ë ¬ UI */
        .filter-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-group label {
            font-weight: bold;
            color: #333;
        }

        .filter-group select {
            padding: 8px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
        }

        /* ëª¨ë‹¬ ë¼ì´íŠ¸ë°•ìŠ¤ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
        }

        .modal-image {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 10px;
            object-fit: contain;
        }

        .modal-info {
            background: white;
            padding: 20px;
            border-radius: 0 0 10px 10px;
            margin-top: -5px;
        }

        .modal-info h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .modal-info p {
            color: #666;
            margin-bottom: 5px;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
        }

        .modal-close:hover {
            background: #f0f0f0;
        }

        .modal-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
        }

        .modal-nav:hover {
            background: white;
        }

        .modal-nav.prev {
            left: 20px;
        }

        .modal-nav.next {
            right: 20px;
        }

        .image-counter {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .image-upload-options {
                grid-template-columns: 1fr;
            }

            .outfit-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ ì°©ìƒ· ê´€ë¦¬ì í˜ì´ì§€</h1>
            <p>ì£¼ìš°ì¬ ì°©ìƒ·ì„ ì¶”ê°€í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>
        </div>

        <div class="nav-buttons">
            <a href="index.html">ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
            <button onclick="exportData()" style="margin-left: 10px; background: #28a745;">ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
            <label for="importFile" style="margin-left: 10px; display: inline-block; padding: 10px 20px; background: #007bff; color: white; border-radius: 10px; cursor: pointer; font-weight: bold;">
                ğŸ“¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            </label>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
        </div>

        <div id="successMessage" class="success-message">
            ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!
        </div>

        <div class="card">
            <div class="form-section">
                <h2>ìƒˆ ì°©ìƒ· ì¶”ê°€</h2>

                <div class="form-group">
                    <label>ë‚ ì”¨ ì¹´í…Œê³ ë¦¬ (ì˜¨ë„ ê¸°ì¤€)</label>
                    <select id="category">
                        <option value="veryhot">ğŸ”¥ ë§¤ìš° ë”ì›€ (28ë„ ì´ìƒ)</option>
                        <option value="hot">â˜€ï¸ ë”ì›€ (23-28ë„)</option>
                        <option value="warm">ğŸŒ¤ï¸ ë”°ëœ»í•¨ (20-23ë„)</option>
                        <option value="mild">ğŸ‚ ì„ ì„ í•¨ (17-20ë„)</option>
                        <option value="cool">ğŸŒ¥ï¸ ìŒ€ìŒ€í•¨ (12-17ë„)</option>
                        <option value="cold">â„ï¸ ì¶”ì›€ (7-12ë„)</option>
                        <option value="verycold">ğŸ§Š ë§¤ìš° ì¶”ì›€ (3-7ë„)</option>
                        <option value="freezing">ğŸ¥¶ í•œíŒŒ (3ë„ ì´í•˜)</option>
                        <option value="rainy">ğŸŒ§ï¸ ë¹„ì˜¤ëŠ” ë‚ </option>
                    </select>
                </div>

                <div class="image-upload-options">
                    <div class="upload-option">
                        <h3>âš ï¸ ì´ë¯¸ì§€ URL ì…ë ¥ (ê¶Œì¥)</h3>
                        <input type="url" id="imageUrl" placeholder="https://example.com/image.jpg" oninput="handleUrlInput()">
                        <div class="preview-area" id="urlPreview"></div>
                        <p style="font-size: 0.9em; color: #666; margin-top: 8px;">
                            ğŸ’¡ ì´ë¯¸ì§€ URLì„ ì‚¬ìš©í•˜ë©´ CORS ë¬¸ì œ ì—†ì´ ë°”ë¡œ ì €ì¥ë©ë‹ˆë‹¤.<br>
                            ì˜ˆ: <code>https://via.placeholder.com/400x600</code>
                        </p>
                    </div>

                    <div class="upload-option">
                        <h3>ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ (í˜„ì¬ ì‚¬ìš© ë¶ˆê°€)</h3>
                        <div class="file-input-wrapper">
                            <input type="file" id="fileInput" accept="image/*" onchange="handleFileSelect(event)" disabled>
                            <label for="fileInput" class="file-input-label" style="opacity: 0.5; cursor: not-allowed;">íŒŒì¼ ì„ íƒ (ë¹„í™œì„±í™”)</label>
                        </div>
                        <div class="preview-area" id="filePreview"></div>
                        <p style="font-size: 0.9em; color: #999; margin-top: 8px;">
                            âš ï¸ Firebase Storage CORS ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. ë‹¹ë¶„ê°„ ì´ë¯¸ì§€ URLì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.
                        </p>
                    </div>
                </div>

                <div class="form-group">
                    <label>ì°©ìƒ· ì œëª©</label>
                    <input type="text" id="title" placeholder="ì˜ˆ: ì—¬ë¦„ í™”ì´íŠ¸ ì…”ì¸  ë£©">
                </div>

                <div class="form-group">
                    <label>ì„¤ëª…</label>
                    <textarea id="description" placeholder="ì˜ˆ: ì‹œì›í•œ í™”ì´íŠ¸ ì…”ì¸  + ë² ì´ì§€ íŒ¬ì¸ "></textarea>
                </div>

                <div class="form-group">
                    <label>ì ì • ì˜¨ë„</label>
                    <input type="text" id="temp" placeholder="ì˜ˆ: 25-30Â°C">
                </div>

                <div>
                    <button onclick="saveOutfit()">ì €ì¥í•˜ê¸°</button>
                    <button class="secondary" onclick="clearForm()">ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>ì €ì¥ëœ ì°©ìƒ· ëª©ë¡</h2>

            <div class="filter-section">
                <div class="filter-group">
                    <label>í•„í„°:</label>
                    <select id="filterCategory" onchange="filterOutfits()">
                        <option value="all">ì „ì²´</option>
                        <option value="veryhot">ğŸ”¥ ë§¤ìš° ë”ì›€</option>
                        <option value="hot">â˜€ï¸ ë”ì›€</option>
                        <option value="warm">ğŸŒ¤ï¸ ë”°ëœ»í•¨</option>
                        <option value="mild">ğŸ‚ ì„ ì„ í•¨</option>
                        <option value="cool">ğŸŒ¥ï¸ ìŒ€ìŒ€í•¨</option>
                        <option value="cold">â„ï¸ ì¶”ì›€</option>
                        <option value="verycold">ğŸ§Š ë§¤ìš° ì¶”ì›€</option>
                        <option value="freezing">ğŸ¥¶ í•œíŒŒ</option>
                        <option value="rainy">ğŸŒ§ï¸ ë¹„ì˜¤ëŠ” ë‚ </option>
                    </select>
                </div>

                <div class="filter-group">
                    <label>ì •ë ¬:</label>
                    <select id="sortOrder" onchange="filterOutfits()">
                        <option value="newest">ìµœì‹ ìˆœ</option>
                        <option value="oldest">ì˜¤ë˜ëœìˆœ</option>
                        <option value="title">ì œëª©ìˆœ</option>
                        <option value="rating">í‰ì  ë†’ì€ìˆœ</option>
                        <option value="wearCount">ì°©ìš© ë§ì€ìˆœ</option>
                    </select>
                </div>
            </div>

            <div id="outfitList" class="outfit-list"></div>
        </div>
    </div>

    <!-- ì´ë¯¸ì§€ ëª¨ë‹¬ -->
    <div id="imageModal" class="modal" onclick="closeModal(event)">
        <button class="modal-close" onclick="closeModal(event)">&times;</button>
        <button class="modal-nav prev" onclick="navigateImage(-1, event)">&#8249;</button>
        <button class="modal-nav next" onclick="navigateImage(1, event)">&#8250;</button>

        <div class="modal-content">
            <img id="modalImage" class="modal-image" src="" alt="">
            <div class="modal-info">
                <span class="category" id="modalCategory"></span>
                <h3 id="modalTitle"></h3>
                <p id="modalDescription"></p>
                <p><strong id="modalTemp"></strong></p>
            </div>
        </div>

        <div class="image-counter">
            <span id="currentImageIndex">1</span> / <span id="totalImages">1</span>
        </div>
    </div>

    <!-- ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editModal" class="modal" onclick="closeEditModal(event)">
        <div class="modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto;" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeEditModal(event)">&times;</button>

            <div style="padding: 30px;">
                <h2 style="margin-bottom: 20px; color: #333;">ì°©ìƒ· ìˆ˜ì •</h2>

                <div class="form-group">
                    <label>ë‚ ì”¨ ì¹´í…Œê³ ë¦¬</label>
                    <select id="editCategory">
                        <option value="veryhot">ğŸ”¥ ë§¤ìš° ë”ì›€ (28ë„ ì´ìƒ)</option>
                        <option value="hot">â˜€ï¸ ë”ì›€ (23-28ë„)</option>
                        <option value="warm">ğŸŒ¤ï¸ ë”°ëœ»í•¨ (20-23ë„)</option>
                        <option value="mild">ğŸ‚ ì„ ì„ í•¨ (17-20ë„)</option>
                        <option value="cool">ğŸŒ¥ï¸ ìŒ€ìŒ€í•¨ (12-17ë„)</option>
                        <option value="cold">â„ï¸ ì¶”ì›€ (7-12ë„)</option>
                        <option value="verycold">ğŸ§Š ë§¤ìš° ì¶”ì›€ (3-7ë„)</option>
                        <option value="freezing">ğŸ¥¶ í•œíŒŒ (3ë„ ì´í•˜)</option>
                        <option value="rainy">ğŸŒ§ï¸ ë¹„ì˜¤ëŠ” ë‚ </option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ì œëª©</label>
                    <input type="text" id="editTitle" placeholder="ì˜ˆ: ì—¬ë¦„ í™”ì´íŠ¸ ì…”ì¸  ë£©">
                </div>

                <div class="form-group">
                    <label>ì„¤ëª…</label>
                    <textarea id="editDescription" rows="3" placeholder="ì˜ˆ: ì‹œì›í•œ í™”ì´íŠ¸ ì…”ì¸  + ë² ì´ì§€ íŒ¬ì¸ "></textarea>
                </div>

                <div class="form-group">
                    <label>ì˜¨ë„ í‘œì‹œ</label>
                    <input type="text" id="editTemp" placeholder="ì˜ˆ: 23-28Â°C">
                </div>

                <div class="form-group">
                    <label>í˜„ì¬ ì´ë¯¸ì§€</label>
                    <div id="editImagePreview" style="margin-top: 10px;"></div>
                </div>

                <div class="form-group">
                    <label>ìƒˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ (ì„ íƒì‚¬í•­)</label>
                    <input type="file" id="editImageFile" accept="image/*" onchange="previewEditImage()">
                </div>

                <button onclick="saveEditedOutfit()" style="width: 100%; padding: 15px; font-size: 1.1em; margin-top: 10px;">
                    ğŸ’¾ ìˆ˜ì • ì €ì¥
                </button>
            </div>
        </div>
    </div>

    <script>
        // FirebaseëŠ” firebase-config.jsì—ì„œ ì´ˆê¸°í™”ë¨
        let currentImageData = null;
        let currentModalIndex = 0;
        let filteredOutfits = [];

        // íŒŒì¼ ì„ íƒ ì²˜ë¦¬
        function handleFileSelect(event) {
            const file = event.target.files[0];
            console.log('ğŸ“ íŒŒì¼ ì„ íƒë¨:', file?.name);

            if (!file) return;

            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                currentImageData = e.target.result;
                console.log('âœ… íŒŒì¼ ì½ê¸° ì™„ë£Œ, currentImageData ì„¤ì •ë¨ (Base64 ê¸¸ì´:', e.target.result.length, ')');
                showPreview('filePreview', currentImageData);
                document.getElementById('imageUrl').value = '';
                document.getElementById('urlPreview').innerHTML = '';
            };
            reader.readAsDataURL(file);
        }

        // URL ì…ë ¥ ì²˜ë¦¬
        function handleUrlInput() {
            const url = document.getElementById('imageUrl').value.trim();
            console.log('ğŸ”— URL ì…ë ¥ë¨:', url);

            if (!url) {
                document.getElementById('urlPreview').innerHTML = '';
                console.log('âšª URLì´ ë¹„ì–´ìˆìŒ, currentImageData ì´ˆê¸°í™”');
                currentImageData = null;
                return;
            }

            currentImageData = url;
            console.log('âœ… currentImageData ì„¤ì •ë¨:', currentImageData);
            showPreview('urlPreview', url);
            document.getElementById('fileInput').value = '';
            document.getElementById('filePreview').innerHTML = '';
        }

        // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function showPreview(containerId, imageData) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<img src="${imageData}" alt="ë¯¸ë¦¬ë³´ê¸°" class="preview-image">`;
        }

        // ì°©ìƒ· ì €ì¥
        async function saveOutfit() {
            console.log('ğŸ”µ saveOutfit() í•¨ìˆ˜ í˜¸ì¶œë¨');

            const category = document.getElementById('category').value;
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const temp = document.getElementById('temp').value.trim();

            console.log('ğŸ“ ì…ë ¥ê°’:', { category, title, description, temp });
            console.log('ğŸ–¼ï¸ currentImageData:', currentImageData);

            // currentImageDataê°€ ì—†ìœ¼ë©´ ì…ë ¥ í•„ë“œë¥¼ ì§ì ‘ í™•ì¸ (ë¸Œë¼ìš°ì € í˜¸í™˜ì„± ë³´ì™„)
            if (!currentImageData) {
                const urlInput = document.getElementById('imageUrl').value.trim();
                const fileInput = document.getElementById('fileInput').files[0];

                console.log('âš ï¸ currentImageDataê°€ null, ì…ë ¥ í•„ë“œ ì§ì ‘ í™•ì¸:', { urlInput, fileInput });

                if (urlInput) {
                    // URLì´ ì…ë ¥ë˜ì–´ ìˆìœ¼ë©´ ì‚¬ìš©
                    console.log('âœ… URL ì…ë ¥ í•„ë“œì—ì„œ ì´ë¯¸ì§€ URL ê°€ì ¸ì˜´');
                    currentImageData = urlInput;
                    showPreview('urlPreview', urlInput);
                } else if (fileInput) {
                    // íŒŒì¼ì´ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ ì½ê¸°
                    console.log('âœ… íŒŒì¼ ì…ë ¥ì—ì„œ ì´ë¯¸ì§€ íŒŒì¼ ë°œê²¬, ì½ëŠ” ì¤‘...');
                    await new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            currentImageData = e.target.result;
                            showPreview('filePreview', currentImageData);
                            resolve();
                        };
                        reader.readAsDataURL(fileInput);
                    });
                } else {
                    console.log('âŒ ì´ë¯¸ì§€ ë°ì´í„° ì—†ìŒ (URLë„ ì—†ê³  íŒŒì¼ë„ ì—†ìŒ)');
                    alert('ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
            }

            if (!title || !description || !temp) {
                console.log('âŒ í•„ìˆ˜ í•„ë“œ ëˆ„ë½:', { title: !!title, description: !!description, temp: !!temp });
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            console.log('âœ… ìœ íš¨ì„± ê²€ì‚¬ í†µê³¼, ì €ì¥ ì‹œì‘...');

            const outfitId = Date.now();

            try {
                // Firebase Storageì— ì´ë¯¸ì§€ ì—…ë¡œë“œ
                const imageUrl = await uploadImageToStorage(currentImageData, outfitId);

                const outfit = {
                    id: outfitId,
                    category,
                    title,
                    description,
                    temp,
                    image: imageUrl
                };

                // Firestoreì— ì°©ìƒ· ì €ì¥
                await saveOutfitToFirestore(outfit);

                // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                showSuccessMessage();

                // í¼ ì´ˆê¸°í™”
                clearForm();

                // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                await loadOutfits();
            } catch (error) {
                console.error('ì €ì¥ ì—ëŸ¬:', error);
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // ì°©ìƒ· ì‚­ì œ
        async function deleteOutfit(category, id) {
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                // Firebase Storageì—ì„œ ì´ë¯¸ì§€ ì‚­ì œ ì‹œë„ (ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰)
                try {
                    await deleteImageFromStorage(id);
                    console.log('âœ… Storage ì´ë¯¸ì§€ ì‚­ì œ ì™„ë£Œ');
                } catch (storageError) {
                    console.warn('âš ï¸ Storage ì´ë¯¸ì§€ ì‚­ì œ ì‹¤íŒ¨ (ë¬´ì‹œ):', storageError);
                    // Storage ì‚­ì œ ì‹¤íŒ¨ëŠ” ë¬´ì‹œí•˜ê³  ê³„ì† ì§„í–‰
                }

                // Firestoreì—ì„œ ì°©ìƒ· ì‚­ì œ (í•„ìˆ˜)
                await deleteOutfitFromFirestore(id);
                console.log('âœ… Firestore ì°©ìƒ· ì‚­ì œ ì™„ë£Œ');

                await loadOutfits();
                alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error('âŒ ì‚­ì œ ì—ëŸ¬:', error);
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í¼ ì´ˆê¸°í™”
        function clearForm() {
            document.getElementById('title').value = '';
            document.getElementById('description').value = '';
            document.getElementById('temp').value = '';
            document.getElementById('imageUrl').value = '';
            document.getElementById('fileInput').value = '';
            document.getElementById('filePreview').innerHTML = '';
            document.getElementById('urlPreview').innerHTML = '';
            currentImageData = null;
        }

        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        function showSuccessMessage() {
            const message = document.getElementById('successMessage');
            message.classList.add('show');
            setTimeout(() => {
                message.classList.remove('show');
            }, 3000);
        }

        // ì¹´í…Œê³ ë¦¬ ì´ë¦„ ë³€í™˜
        function getCategoryName(category) {
            const names = {
                veryhot: 'ğŸ”¥ ë§¤ìš° ë”ì›€ (28ë„+)',
                hot: 'â˜€ï¸ ë”ì›€ (23-28ë„)',
                warm: 'ğŸŒ¤ï¸ ë”°ëœ»í•¨ (20-23ë„)',
                mild: 'ğŸ‚ ì„ ì„ í•¨ (17-20ë„)',
                cool: 'ğŸŒ¥ï¸ ìŒ€ìŒ€í•¨ (12-17ë„)',
                cold: 'â„ï¸ ì¶”ì›€ (7-12ë„)',
                verycold: 'ğŸ§Š ë§¤ìš° ì¶”ì›€ (3-7ë„)',
                freezing: 'ğŸ¥¶ í•œíŒŒ (3ë„ ì´í•˜)',
                rainy: 'ğŸŒ§ï¸ ë¹„ì˜¤ëŠ” ë‚ '
            };
            return names[category] || category;
        }

        // ì´ë¯¸ì§€ ëª¨ë‹¬ ì—´ê¸°
        function openImageModal(index) {
            const modal = document.getElementById('imageModal');
            currentModalIndex = index;
            updateModalContent();
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal(event) {
            if (event.target.id === 'imageModal' || event.target.className === 'modal-close') {
                const modal = document.getElementById('imageModal');
                modal.classList.remove('show');
                document.body.style.overflow = 'auto';
            }
        }

        // ì´ë¯¸ì§€ ë„¤ë¹„ê²Œì´ì…˜
        function navigateImage(direction, event) {
            event.stopPropagation();
            currentModalIndex += direction;

            if (currentModalIndex < 0) {
                currentModalIndex = filteredOutfits.length - 1;
            } else if (currentModalIndex >= filteredOutfits.length) {
                currentModalIndex = 0;
            }

            updateModalContent();
        }

        // ëª¨ë‹¬ ë‚´ìš© ì—…ë°ì´íŠ¸
        function updateModalContent() {
            const outfit = filteredOutfits[currentModalIndex];
            document.getElementById('modalImage').src = outfit.image;
            document.getElementById('modalCategory').textContent = getCategoryName(outfit.category);
            document.getElementById('modalTitle').textContent = outfit.title;

            // ì„¤ëª…ì— í‰ì ê³¼ ì°©ìš© ê¸°ë¡ ì¶”ê°€
            let description = outfit.description;
            if (outfit.rating && outfit.rating > 0) {
                description += `\n\nâ­ í‰ì : ${outfit.rating}/5`;
            }
            if (outfit.wearHistory && outfit.wearHistory.length > 0) {
                description += `\nğŸ‘” ì°©ìš© íšŸìˆ˜: ${outfit.wearHistory.length}íšŒ`;
                // ìµœê·¼ 3ê°œ ì°©ìš© ê¸°ë¡ í‘œì‹œ
                const recentWears = outfit.wearHistory.slice(0, 3);
                description += `\nìµœê·¼ ì°©ìš©: ${recentWears.join(', ')}`;
            }

            document.getElementById('modalDescription').textContent = description;
            document.getElementById('modalTemp').textContent = outfit.temp;
            document.getElementById('currentImageIndex').textContent = currentModalIndex + 1;
            document.getElementById('totalImages').textContent = filteredOutfits.length;
        }

        // í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('imageModal');
            if (modal.classList.contains('show')) {
                if (e.key === 'ArrowLeft') {
                    navigateImage(-1, e);
                } else if (e.key === 'ArrowRight') {
                    navigateImage(1, e);
                } else if (e.key === 'Escape') {
                    modal.classList.remove('show');
                    document.body.style.overflow = 'auto';
                }
            }
        });

        // í•„í„°ë§ ë° ì •ë ¬
        async function filterOutfits() {
            const allOutfits = await getAllOutfitsFromFirestore();
            const filterCategory = document.getElementById('filterCategory').value;
            const sortOrder = document.getElementById('sortOrder').value;

            // í•„í„°ë§
            filteredOutfits = filterCategory === 'all'
                ? allOutfits
                : allOutfits.filter(outfit => outfit.category === filterCategory);

            // ì •ë ¬
            if (sortOrder === 'newest') {
                filteredOutfits.sort((a, b) => b.id - a.id);
            } else if (sortOrder === 'oldest') {
                filteredOutfits.sort((a, b) => a.id - b.id);
            } else if (sortOrder === 'title') {
                filteredOutfits.sort((a, b) => a.title.localeCompare(b.title));
            } else if (sortOrder === 'rating') {
                filteredOutfits.sort((a, b) => (b.rating || 0) - (a.rating || 0));
            } else if (sortOrder === 'wearCount') {
                filteredOutfits.sort((a, b) => {
                    const aCount = a.wearHistory ? a.wearHistory.length : 0;
                    const bCount = b.wearHistory ? b.wearHistory.length : 0;
                    return bCount - aCount;
                });
            }

            displayOutfits();
        }

        // ì°©ìƒ· í‘œì‹œ
        function displayOutfits() {
            const container = document.getElementById('outfitList');
            container.innerHTML = '';

            if (filteredOutfits.length === 0) {
                container.innerHTML = '<div class="empty-state">ì•„ì§ ì¶”ê°€ëœ ì°©ìƒ·ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            filteredOutfits.forEach((outfit, index) => {
                const card = document.createElement('div');
                card.className = 'outfit-item';

                // í‰ì  í‘œì‹œ
                const ratingDisplay = outfit.rating && outfit.rating > 0
                    ? `<p style="color: #ffd700; font-size: 0.9em;">â­ ${outfit.rating}/5</p>`
                    : '<p style="color: #999; font-size: 0.9em;">í‰ì  ì—†ìŒ</p>';

                // ì°©ìš© íšŸìˆ˜ í‘œì‹œ
                const wearCount = outfit.wearHistory && outfit.wearHistory.length > 0
                    ? `<p style="color: #667eea; font-size: 0.9em;">ğŸ‘” ${outfit.wearHistory.length}íšŒ ì°©ìš©</p>`
                    : '<p style="color: #999; font-size: 0.9em;">ì°©ìš© ê¸°ë¡ ì—†ìŒ</p>';

                card.innerHTML = `
                    <img src="${outfit.image}" alt="${outfit.title}" onclick="openImageModal(${index})">
                    <div class="outfit-item-info">
                        <span class="category">${getCategoryName(outfit.category)}</span>
                        <h3>${outfit.title}</h3>
                        <p>${outfit.description}</p>
                        <p><strong>${outfit.temp}</strong></p>
                        ${ratingDisplay}
                        ${wearCount}
                        <div class="outfit-item-actions">
                            <button onclick="openEditModal(${outfit.id})">ìˆ˜ì •</button>
                            <button class="danger" onclick="deleteOutfit('${outfit.category}', ${outfit.id})">ì‚­ì œ</button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // ì°©ìƒ· ëª©ë¡ ë¡œë“œ
        async function loadOutfits() {
            await filterOutfits();
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        async function exportData() {
            try {
                const allOutfits = await getAllOutfitsFromFirestore();

                if (allOutfits.length === 0) {
                    alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                // JSONìœ¼ë¡œ ë³€í™˜
                const dataStr = JSON.stringify(allOutfits, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });

                // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„±
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `outfit-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                alert(`âœ… ${allOutfits.length}ê°œì˜ ì°©ìƒ· ë°ì´í„°ë¥¼ ë‚´ë³´ëƒˆìŠµë‹ˆë‹¤!`);
            } catch (error) {
                console.error('ë‚´ë³´ë‚´ê¸° ì˜¤ë¥˜:', error);
                alert('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            try {
                const text = await file.text();
                const data = JSON.parse(text);

                if (!Array.isArray(data)) {
                    alert('ì˜¬ë°”ë¥´ì§€ ì•Šì€ ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤.');
                    return;
                }

                // í™•ì¸ ë©”ì‹œì§€
                const confirm = window.confirm(
                    `${data.length}ê°œì˜ ì°©ìƒ· ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.\n` +
                    'ê¸°ì¡´ ë°ì´í„°ëŠ” ìœ ì§€ë˜ê³ , ìƒˆë¡œìš´ ë°ì´í„°ê°€ ì¶”ê°€ë©ë‹ˆë‹¤.\n' +
                    'ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'
                );

                if (!confirm) return;

                // Firestoreì— ì €ì¥
                let successCount = 0;
                for (const outfit of data) {
                    try {
                        // IDê°€ ì¤‘ë³µë˜ë©´ ìƒˆ ID ìƒì„±
                        outfit.id = Date.now() + successCount;

                        // ì´ë¯¸ì§€ ì—…ë¡œë“œ (Base64ì¸ ê²½ìš°ë§Œ)
                        if (outfit.image && outfit.image.startsWith('data:image')) {
                            outfit.image = await uploadImageToStorage(outfit.image, outfit.id);
                        }

                        await saveOutfitToFirestore(outfit);
                        successCount++;
                    } catch (error) {
                        console.error('ì°©ìƒ· ì €ì¥ ì˜¤ë¥˜:', error);
                    }
                }

                // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                await loadOutfits();

                alert(`âœ… ${successCount}ê°œì˜ ì°©ìƒ·ì„ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!`);

                // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
                event.target.value = '';
            } catch (error) {
                console.error('ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
                alert('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì˜¬ë°”ë¥¸ JSON íŒŒì¼ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }

        // ìˆ˜ì •í•  ì°©ìƒ· ì •ë³´ ì €ì¥
        let currentEditOutfit = null;
        let newEditImageData = null;

        // ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
        async function openEditModal(outfitId) {
            try {
                // Firestoreì—ì„œ ì°©ìƒ· ê°€ì ¸ì˜¤ê¸°
                const outfit = await getOutfitFromFirestore(outfitId);

                if (!outfit) {
                    alert('ì°©ìƒ·ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                currentEditOutfit = outfit;
                newEditImageData = null;

                // í¼ì— í˜„ì¬ ë°ì´í„° ì±„ìš°ê¸°
                document.getElementById('editCategory').value = outfit.category;
                document.getElementById('editTitle').value = outfit.title;
                document.getElementById('editDescription').value = outfit.description;
                document.getElementById('editTemp').value = outfit.temp;

                // í˜„ì¬ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
                const preview = document.getElementById('editImagePreview');
                preview.innerHTML = `<img src="${outfit.image}" alt="${outfit.title}" style="max-width: 100%; border-radius: 10px;">`;

                // ìƒˆ ì´ë¯¸ì§€ ì…ë ¥ ì´ˆê¸°í™”
                document.getElementById('editImageFile').value = '';

                // ëª¨ë‹¬ ì—´ê¸°
                document.getElementById('editModal').classList.add('show');
                document.body.style.overflow = 'hidden';
            } catch (error) {
                console.error('ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸° ì˜¤ë¥˜:', error);
                alert('ì°©ìƒ· ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
        function closeEditModal(event) {
            if (event.target.id === 'editModal' || event.target.className === 'modal-close') {
                document.getElementById('editModal').classList.remove('show');
                document.body.style.overflow = 'auto';
                currentEditOutfit = null;
                newEditImageData = null;
            }
        }

        // ìƒˆ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
        function previewEditImage() {
            const file = document.getElementById('editImageFile').files[0];

            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                newEditImageData = e.target.result;
                const preview = document.getElementById('editImagePreview');
                preview.innerHTML = `<img src="${newEditImageData}" alt="ìƒˆ ì´ë¯¸ì§€" style="max-width: 100%; border-radius: 10px;">`;
            };
            reader.readAsDataURL(file);
        }

        // ìˆ˜ì •ëœ ì°©ìƒ· ì €ì¥
        async function saveEditedOutfit() {
            if (!currentEditOutfit) {
                alert('ì˜¤ë¥˜: ìˆ˜ì •í•  ì°©ìƒ· ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const category = document.getElementById('editCategory').value;
            const title = document.getElementById('editTitle').value.trim();
            const description = document.getElementById('editDescription').value.trim();
            const temp = document.getElementById('editTemp').value.trim();

            if (!title || !description || !temp) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                let imageUrl = currentEditOutfit.image;

                // ìƒˆ ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì—…ë¡œë“œ
                if (newEditImageData) {
                    imageUrl = await uploadImageToStorage(newEditImageData, currentEditOutfit.id);
                }

                // ìˆ˜ì •ëœ ë°ì´í„°ë¡œ ê°ì²´ ì—…ë°ì´íŠ¸
                const updatedOutfit = {
                    ...currentEditOutfit,
                    category,
                    title,
                    description,
                    temp,
                    image: imageUrl
                };

                // Firestoreì— ì €ì¥
                await updateOutfitInFirestore(updatedOutfit);

                // ì„±ê³µ ë©”ì‹œì§€
                showSuccessMessage();

                // ëª¨ë‹¬ ë‹«ê¸°
                document.getElementById('editModal').classList.remove('show');
                document.body.style.overflow = 'auto';

                // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                await loadOutfits();

                currentEditOutfit = null;
                newEditImageData = null;
            } catch (error) {
                console.error('ì €ì¥ ì˜¤ë¥˜:', error);
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', async () => {
            await loadOutfits();
        });
    </script>
</body>
</html>
